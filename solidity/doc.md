* 什么是 evm ？
    JVM java virtuaul machine jvm字节码
    EVM ethreum virtuaul machine evm字节码
    solidity 强类型脚本语言 compiler => evm bytescode => evm

* 每次发生一次交互（交易），都发生了什么？
    区块链创建了一个 evm 实例，执行合约的字节码，对数据进行处理运算

* EVM 的存储结构：
    Stack（栈）
  ​	    EVM 执行栈
  ​        每个栈有1024个slot（槽位）,如果超出数量会报错“stack too depp"
  ​        每个slot空间是 32字节，也就是256个比特位
  
    Memory
        EVM 临时内存
  
    Storage
        存储在链上永久的数据

数据的长度如果知道，并且不超过256个比特位的，就放在栈里；
如果长度不知道或超过256个比特位，放在Memroy或Storage。
基于这两点，可以对数据进行分类。

* 数据分类：
      基本类型
          长度固定，实际数据就在 Stack

        整数
            unit => 无符号整型，默认 uint256
            int => -+整型，默认 int256
        布尔
            bool
        地址
            address
        枚举
            enum
        字节
            bytes，最大32位，即 bytes32。
  
    引用类型
        长度未知或者超过32bit，实际数据在 Memory 或 Storage，Stack 里只有一个 keccack256 类型的哈希，指向 Memory 或 Storage 里存储的数据位置。
  
        数组
        字符串
        结构体
        映射

* 可见度修饰符

  | 可见性修饰符 | 外部能调用？  | 合约内部能调用？  | 子合约能继承？ | 用于               |
  | ------------ | ------------- | ----------------- | -------------- | ------------------ |
  | `public`     | ✅             | ✅                 | ✅              | 通用外部接口       |
  | `external`   | ✅（只能外部） | ❌（不能内部调用） | ✅              | 节省 gas、仅限外部 |
  | `internal`   | ❌             | ✅                 | ✅              | 工具函数、继承共享 |
  | `private`    | ❌             | ✅                 | ❌              | 合约内部封装       |

* 函数的状态可变性修饰符

  可变性修饰符用于限制合约的函数能够改变合约的状态或执行其他操作。

  | 可变性修饰符 | 读取状态变量 | 写入状态变量 | 消耗Gas | 描述                                                         |
  | ------------ | ------------ | ------------ | ------- | ------------------------------------------------------------ |
  | pure         | ❌            | ❌            | ❌       | 不会消耗Gas，除非被外部调用                                  |
  | view         | ✅            | ❌            | ❌       |                                                              |
  | default      | ✅            | ✅            |         |                                                              |
  | payable      |              |              | ✅       | 1. 函数允许**接收以太币**<br />2. 只有标记为 `payable` 的函数才能接收以太币<br />3.**会消耗 Gas**，因为它涉及到外部交易和转账 |

  

* .transfer(amount) 和 .send(amount) 区别？

  | **特性**         | **`.transfer(amount)`**            | **`.send(amount)`**                      |
  | ---------------- | ---------------------------------- | ---------------------------------------- |
  | **定义**         | 向地址发送指定ETH，失败时抛出异常  | 向地址发送指定ETH，失败时返回 `false`    |
  | **Gas限制**      | 固定2300 Gas                       | 固定2300 Gas                             |
  | **错误处理**     | 失败时回滚交易（抛出异常）         | 失败时返回 `false`，不回滚（需手动检查） |
  | **安全性**       | 较安全（因失败回滚），但仍需防重入 | 风险较高（需检查返回值），易遗漏错误处理 |
  | **Solidity版本** | 0.5.0+（需 `payable` 转换）        | 0.5.0+（需 `payable` 转换）              |
  | **使用场景**     | 推荐用于简单转账（如取款模式）     | 较少使用，需谨慎处理返回值               |
  
* Solidity中抛出错误的形式及区别

  | **错误类型**       | **`require`**                                                | **`revert`**                                                 | **`assert`**                                                 | **`error`（与 `revert` 配合）**                              |
  | ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | **定义**           | 检查条件，若为假则抛出异常并回滚交易，可附带字符串错误消息。用于输入验证或外部条件检查。 | 手动抛出异常，终止执行并回滚，可搭配字符串或自定义 `error`。灵活，适合复杂逻辑。 | 检查内部不变量，若为假则抛出异常并回滚，通常无消息。用于调试或致命错误。 | 定义自定义错误类型，与 `revert` 配合抛出，传递参数而非字符串，Gas效率高。 |
  | **语法**           | `require(condition, "Error message");`                       | `revert("Error message");` 或 `revert CustomError(params);`  | `assert(condition);`                                         | `error CustomError(type param);`  `revert CustomError(value);` |
  | **Gas成本**        | 中等（字符串消息增加Gas，~200 Gas/字符）                     | 低（自定义 `error` ~几十Gas；字符串较高）                    | 最低（无消息，~几十Gas）                                     | 最低（仅传递错误标识和参数，~几十Gas）                       |
  | **错误处理**       | 回滚交易，返回字符串消息（前端可捕获）                       | 回滚交易，字符串或自定义 `error` 数据可解析                  | 回滚交易，抛出 `Panic` 错误（无详细消息，难以解析）          | 回滚交易，错误名和参数可解析（前端友好）                     |
  | **适用场景**       | 用户输入验证（出价、地址）、外部条件（如余额）               | 复杂逻辑检查、自定义错误、Gas优化场景                        | 内部逻辑错误（如状态不一致）、调试                           | 替代字符串错误，优化Gas，复杂逻辑检查                        |
  | **Web3/DApp相关**  | 前端捕获字符串消息，显示用户提示；需优化Gas                  | 前端解析字符串或 `error` 数据，优化用户体验                  | 调试用，前端难以解析，生产环境少用                           | 前端解析错误名和参数，提供精确提示；Gas高效                  |
  | **与你的问题关联** | 检查 `address(0)`、SLOAD触发前验证                           | 防重入（如 `pendingReturns`）、搭配 `error` 优化             | 检查Storage一致性（如SLOAD后验证）                           | 结合 `revert` 优化 `NoFunds`、`ZeroAddress` 等错误           |

  
